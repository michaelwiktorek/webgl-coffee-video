(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var Graphics, g, start_video, stop_video;

Graphics = require("./gl_util.coffee");

g = null;

window.onload = function() {
  var canvas;
  canvas = document.querySelector('#glcanvas');
  g = new Graphics(canvas);
  document.querySelector('#start_video').onclick = start_video;
  return document.querySelector('#stop_video').onclick = stop_video;
};

start_video = function() {
  return g.start_video();
};

stop_video = function() {
  var vid;
  vid = document.querySelector('video');
  vid.src = '';
  return g.stop_video();
};



},{"./gl_util.coffee":2}],2:[function(require,module,exports){
var Graphics,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Graphics = (function() {
  Graphics.anim_id = null;

  Graphics.gl = null;

  Graphics.buffer = null;

  Graphics.program = null;

  Graphics.vid_stream = null;

  Graphics.texture = null;

  Graphics.video = false;

  Graphics.positionLocation = null;

  Graphics.img = null;

  Graphics.vid = null;

  function Graphics(canvas) {
    this.stop_video = bind(this.stop_video, this);
    this.start_video = bind(this.start_video, this);
    this.init_video = bind(this.init_video, this);
    this.render = bind(this.render, this);
    this.init = bind(this.init, this);
    this.gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
    this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);
    this.img = new Image();
    this.img.src = "../img/internetsurf.jpg";
  }

  Graphics.prototype.init = function() {
    console.log("init");
    this.gl.clearColor(0.0, 0.0, 0.0, 1.0);
    this.gl.clear(this.gl.COLOR_BUFFER_BIT);
    this.init_shaders();
    return this.anim_id = window.requestAnimationFrame(this.render);
  };

  Graphics.prototype.render = function() {
    this.anim_id = window.requestAnimationFrame(this.render);
    if (this.video) {
      this.update_texture();
      return this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);
    }
  };

  Graphics.prototype.init_shaders = function() {
    var buffer, fragmentShader, positionLocation, resolutionLocation, shaderScript, shaderSource, texCoordBuffer, texCoordLocation, vertexShader;
    shaderScript = document.querySelector("#vert-shader");
    shaderSource = shaderScript.text;
    vertexShader = this.gl.createShader(this.gl.VERTEX_SHADER);
    this.gl.shaderSource(vertexShader, shaderSource);
    this.gl.compileShader(vertexShader);
    shaderScript = document.querySelector("#frag-shader");
    shaderSource = shaderScript.text;
    fragmentShader = this.gl.createShader(this.gl.FRAGMENT_SHADER);
    this.gl.shaderSource(fragmentShader, shaderSource);
    this.gl.compileShader(fragmentShader);
    this.program = this.gl.createProgram();
    this.gl.attachShader(this.program, vertexShader);
    this.gl.attachShader(this.program, fragmentShader);
    this.gl.linkProgram(this.program);
    this.gl.useProgram(this.program);
    texCoordLocation = this.gl.getAttribLocation(this.program, "a_texCoord");
    positionLocation = this.gl.getAttribLocation(this.program, "a_position");
    texCoordBuffer = this.gl.createBuffer();
    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, texCoordBuffer);
    this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]), this.gl.STATIC_DRAW);
    this.gl.enableVertexAttribArray(texCoordLocation);
    this.gl.vertexAttribPointer(texCoordLocation, 2, this.gl.FLOAT, false, 0, 0);
    this.init_textures();
    resolutionLocation = this.gl.getUniformLocation(this.program, "u_resolution");
    this.gl.uniform2f(resolutionLocation, 640, 480);
    buffer = this.gl.createBuffer();
    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);
    this.gl.enableVertexAttribArray(positionLocation);
    this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);
    return this.setRectangle(0, 0, 640, 480);
  };

  Graphics.prototype.setRectangle = function(x, y, width, height) {
    var x2, y2;
    x2 = x + width;
    y2 = y + height;
    return this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array([x, y, x2, y, x, y2, x, y2, x2, y, x2, y2]), this.gl.STATIC_DRAW);
  };

  Graphics.prototype.init_video = function() {
    if (this.vid) {
      this.vid.src = this.vid_stream;
      return this.anim_id = window.requestAnimationFrame(this.render);
    } else {
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      this.vid = document.querySelector('video');
      navigator.getUserMedia({
        video: true,
        audio: false
      }, (function(_this) {
        return function(stream) {
          _this.vid_stream = window.URL.createObjectURL(stream);
          return _this.vid.src = _this.vid_stream;
        };
      })(this), function() {
        return alert("error");
      });
      return this.init();
    }
  };

  Graphics.prototype.init_textures = function() {
    this.texture = this.gl.createTexture();
    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);
    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);
    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);
    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);
    return this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);
  };

  Graphics.prototype.update_texture = function() {
    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);
    return this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.vid);
  };

  Graphics.prototype.start_video = function() {
    if (!this.video) {
      this.init_video();
      return this.video = true;
    }
  };

  Graphics.prototype.stop_video = function() {
    window.cancelAnimationFrame(this.anim_id);
    this.video = false;
    this.gl.clearColor(1.0, 1.0, 1.0, 1.0);
    return this.gl.clear(this.gl.COLOR_BUFFER_BIT);
  };

  return Graphics;

})();

module.exports = Graphics;



},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWljaGFlbHdpa3RvcmVrL1NpdGVzL3dlYmdsL3NyYy9tYWluLmNvZmZlZSIsIi9Vc2Vycy9taWNoYWVsd2lrdG9yZWsvU2l0ZXMvd2ViZ2wvc3JjL2dsX3V0aWwuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsSUFBQSxvQ0FBQTs7QUFBQSxRQUFBLEdBQVcsT0FBQSxDQUFRLGtCQUFSLENBQVgsQ0FBQTs7QUFBQSxDQUNBLEdBQUksSUFESixDQUFBOztBQUFBLE1BR00sQ0FBQyxNQUFQLEdBQWdCLFNBQUEsR0FBQTtBQUNkLE1BQUEsTUFBQTtBQUFBLEVBQUEsTUFBQSxHQUFTLFFBQVEsQ0FBQyxhQUFULENBQXVCLFdBQXZCLENBQVQsQ0FBQTtBQUFBLEVBQ0EsQ0FBQSxHQUFRLElBQUEsUUFBQSxDQUFTLE1BQVQsQ0FEUixDQUFBO0FBQUEsRUFFQSxRQUFRLENBQUMsYUFBVCxDQUF1QixjQUF2QixDQUFzQyxDQUFDLE9BQXZDLEdBQWlELFdBRmpELENBQUE7U0FHQSxRQUFRLENBQUMsYUFBVCxDQUF1QixhQUF2QixDQUFxQyxDQUFDLE9BQXRDLEdBQWdELFdBSmxDO0FBQUEsQ0FIaEIsQ0FBQTs7QUFBQSxXQVdBLEdBQWMsU0FBQSxHQUFBO1NBQ1osQ0FBQyxDQUFDLFdBQUYsQ0FBQSxFQURZO0FBQUEsQ0FYZCxDQUFBOztBQUFBLFVBY0EsR0FBYSxTQUFBLEdBQUE7QUFDWCxNQUFBLEdBQUE7QUFBQSxFQUFBLEdBQUEsR0FBTSxRQUFRLENBQUMsYUFBVCxDQUF1QixPQUF2QixDQUFOLENBQUE7QUFBQSxFQUNBLEdBQUcsQ0FBQyxHQUFKLEdBQVEsRUFEUixDQUFBO1NBRUEsQ0FBQyxDQUFDLFVBQUYsQ0FBQSxFQUhXO0FBQUEsQ0FkYixDQUFBOzs7OztBQ0FBLElBQUEsUUFBQTtFQUFBLGdGQUFB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QyxDQUFBLEVBQUUsQ0FBQyxhQUROLEVBQ3FCLElBQUMsQ0FBQSxHQUR0QixFQUhjO0VBQUEsQ0F6SGhCLENBQUE7O0FBQUEscUJBK0hBLFdBQUEsR0FBYSxTQUFBLEdBQUE7QUFDWCxJQUFBLElBQUcsQ0FBQSxJQUFLLENBQUEsS0FBUjtBQUNFLE1BQUEsSUFBQyxDQUFBLFVBQUQsQ0FBQSxDQUFBLENBQUE7YUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTLEtBRlg7S0FEVztFQUFBLENBL0hiLENBQUE7O0FBQUEscUJBbUlBLFVBQUEsR0FBWSxTQUFBLEdBQUE7QUFDVixJQUFBLE1BQU0sQ0FBQyxvQkFBUCxDQUE0QixJQUFDLENBQUEsT0FBN0IsQ0FBQSxDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTLEtBRFQsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLEVBQUUsQ0FBQyxVQUFKLENBQWUsR0FBZixFQUFvQixHQUFwQixFQUF5QixHQUF6QixFQUE4QixHQUE5QixDQUZBLENBQUE7V0FHQSxJQUFDLENBQUEsRUFBRSxDQUFDLEtBQUosQ0FBVSxJQUFDLENBQUEsRUFBRSxDQUFDLGdCQUFkLEVBSlU7RUFBQSxDQW5JWixDQUFBOztrQkFBQTs7SUFERixDQUFBOztBQUFBLE1BK0lNLENBQUMsT0FBUCxHQUFpQixRQS9JakIsQ0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJHcmFwaGljcyA9IHJlcXVpcmUgXCIuL2dsX3V0aWwuY29mZmVlXCJcbmcgPSBudWxsXG5cbndpbmRvdy5vbmxvYWQgPSAtPlxuICBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2xjYW52YXMnKVxuICBnID0gbmV3IEdyYXBoaWNzKGNhbnZhcylcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N0YXJ0X3ZpZGVvJykub25jbGljayA9IHN0YXJ0X3ZpZGVvXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdG9wX3ZpZGVvJykub25jbGljayA9IHN0b3BfdmlkZW9cbiAgXG4gIFxuXG5zdGFydF92aWRlbyA9IC0+XG4gIGcuc3RhcnRfdmlkZW8oKVxuXG5zdG9wX3ZpZGVvID0gLT5cbiAgdmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndmlkZW8nKVxuICB2aWQuc3JjPScnXG4gIGcuc3RvcF92aWRlbygpXG5cblxuICAgICIsImNsYXNzIEdyYXBoaWNzXG4gIEBhbmltX2lkOiBudWxsXG4gIEBnbDogbnVsbFxuICBAYnVmZmVyOiBudWxsICMgZm9yIG91ciBkcmF3aW5nIHN1cmZhY2VcbiAgQHByb2dyYW06IG51bGxcbiAgQHZpZF9zdHJlYW06IG51bGxcbiAgQHRleHR1cmU6IG51bGxcbiAgQHZpZGVvOiBmYWxzZVxuICBAcG9zaXRpb25Mb2NhdGlvbjogbnVsbFxuICBAaW1nOiBudWxsXG4gIEB2aWQ6IG51bGwgIyB2aWRlbyBvYmplY3RcblxuICBjb25zdHJ1Y3RvcjogKGNhbnZhcykgLT5cbiAgICBAZ2wgPSBjYW52YXMuZ2V0Q29udGV4dChcIndlYmdsXCIpIHx8IGNhbnZhcy5nZXRDb250ZXh0KFwiZXhwZXJpbWVudGFsLXdlYmdsXCIpXG4gICAgQGdsLnZpZXdwb3J0KDAsMCwgQGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgQGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpXG4gICAgQGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIEBpbWcuc3JjID0gXCIuLi9pbWcvaW50ZXJuZXRzdXJmLmpwZ1wiXG4gICAgI0BpbWcub25sb2FkID0gQGluaXRcblxuICAjIGluaXRpYWxpemUgZ3JhcGhpY3NcbiAgaW5pdDogPT5cbiAgICBjb25zb2xlLmxvZyhcImluaXRcIilcbiAgICBAZ2wuY2xlYXJDb2xvcigwLjAsIDAuMCwgMC4wLCAxLjApXG4gICAgQGdsLmNsZWFyKEBnbC5DT0xPUl9CVUZGRVJfQklUKVxuXG4gICAgQGluaXRfc2hhZGVycygpICMgaW5pdGlhbGl6ZSBzaGFkZXJzXG4gICAgQGFuaW1faWQgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKEByZW5kZXIpICAgICAgICMgYmVnaW4gcmVuZGVyaW5nXG5cbiAgcmVuZGVyOiA9PlxuICAgIEBhbmltX2lkID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShAcmVuZGVyKVxuICAgIGlmIEB2aWRlb1xuICAgICAgQHVwZGF0ZV90ZXh0dXJlKClcbiAgICAgICMgQGdsLnRleEltYWdlMkQoQGdsLlRFWFRVUkVfMkQsIDAsIEBnbC5SR0JBLCBAZ2wuUkdCQSxcbiAgICAgICMgQGdsLlVOU0lHTkVEX0JZVEUsIEBpbWcpXG4gICAgICBAZ2wuZHJhd0FycmF5cyhAZ2wuVFJJQU5HTEVTLCAwLCA2KVxuXG4gICMgaW5pdGlhbGl6ZSBzaGFkZXJzIGZyb20gaHRtbFxuICBpbml0X3NoYWRlcnM6IC0+XG4gICAgc2hhZGVyU2NyaXB0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN2ZXJ0LXNoYWRlclwiKVxuICAgIHNoYWRlclNvdXJjZSA9IHNoYWRlclNjcmlwdC50ZXh0XG4gICAgdmVydGV4U2hhZGVyID0gQGdsLmNyZWF0ZVNoYWRlcihAZ2wuVkVSVEVYX1NIQURFUilcbiAgICBAZ2wuc2hhZGVyU291cmNlKHZlcnRleFNoYWRlciwgc2hhZGVyU291cmNlKVxuICAgIEBnbC5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlcilcblxuICAgIHNoYWRlclNjcmlwdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZnJhZy1zaGFkZXJcIilcbiAgICBzaGFkZXJTb3VyY2UgPSBzaGFkZXJTY3JpcHQudGV4dFxuICAgIGZyYWdtZW50U2hhZGVyID0gQGdsLmNyZWF0ZVNoYWRlcihAZ2wuRlJBR01FTlRfU0hBREVSKVxuICAgIEBnbC5zaGFkZXJTb3VyY2UoZnJhZ21lbnRTaGFkZXIsIHNoYWRlclNvdXJjZSlcbiAgICBAZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcilcblxuICAgIEBwcm9ncmFtID0gQGdsLmNyZWF0ZVByb2dyYW0oKVxuICAgIEBnbC5hdHRhY2hTaGFkZXIoQHByb2dyYW0sIHZlcnRleFNoYWRlcilcbiAgICBAZ2wuYXR0YWNoU2hhZGVyKEBwcm9ncmFtLCBmcmFnbWVudFNoYWRlcilcbiAgICBAZ2wubGlua1Byb2dyYW0oQHByb2dyYW0pXG4gICAgQGdsLnVzZVByb2dyYW0oQHByb2dyYW0pXG5cbiAgICB0ZXhDb29yZExvY2F0aW9uID0gQGdsLmdldEF0dHJpYkxvY2F0aW9uKEBwcm9ncmFtLCBcImFfdGV4Q29vcmRcIilcbiAgICBwb3NpdGlvbkxvY2F0aW9uID0gQGdsLmdldEF0dHJpYkxvY2F0aW9uKEBwcm9ncmFtLCBcImFfcG9zaXRpb25cIilcblxuICAgIHRleENvb3JkQnVmZmVyID0gQGdsLmNyZWF0ZUJ1ZmZlcigpXG4gICAgQGdsLmJpbmRCdWZmZXIoQGdsLkFSUkFZX0JVRkZFUiwgdGV4Q29vcmRCdWZmZXIpXG4gICAgQGdsLmJ1ZmZlckRhdGEoQGdsLkFSUkFZX0JVRkZFUiwgXG4gICAgICBuZXcgRmxvYXQzMkFycmF5KFxuICAgICAgICBbMC4wLCAgMC4wLFxuICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgMC4wLCAgMS4wLFxuICAgICAgICAgMC4wLCAgMS4wLFxuICAgICAgICAgMS4wLCAgMC4wLFxuICAgICAgICAgMS4wLCAgMS4wXSksIFxuICAgICAgQGdsLlNUQVRJQ19EUkFXKVxuICAgIEBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0ZXhDb29yZExvY2F0aW9uKVxuICAgIEBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHRleENvb3JkTG9jYXRpb24sIDIsIEBnbC5GTE9BVCwgZmFsc2UsIDAsIDApXG5cbiAgICBAaW5pdF90ZXh0dXJlcygpXG5cblxuICAgIHJlc29sdXRpb25Mb2NhdGlvbiA9IEBnbC5nZXRVbmlmb3JtTG9jYXRpb24oQHByb2dyYW0sIFwidV9yZXNvbHV0aW9uXCIpXG4gICAgQGdsLnVuaWZvcm0yZihyZXNvbHV0aW9uTG9jYXRpb24sIDY0MCwgNDgwKVxuICAgIGJ1ZmZlciA9IEBnbC5jcmVhdGVCdWZmZXIoKVxuICAgIEBnbC5iaW5kQnVmZmVyKEBnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcilcbiAgICBAZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkocG9zaXRpb25Mb2NhdGlvbilcbiAgICBAZ2wudmVydGV4QXR0cmliUG9pbnRlcihwb3NpdGlvbkxvY2F0aW9uLCAyLCBAZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKVxuICAgIEBzZXRSZWN0YW5nbGUoMCwgMCwgNjQwLCA0ODApXG4gICAgIyBAcG9zaXRpb25Mb2NhdGlvbiA9IEBnbC5nZXRBdHRyaWJMb2NhdGlvbihAcHJvZ3JhbSwgXCJhX3Bvc2l0aW9uXCIpXG4gICAgIyBAZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoQHBvc2l0aW9uTG9jYXRpb24pXG4gICAgIyBAZ2wudmVydGV4QXR0cmliUG9pbnRlcihAcG9zaXRpb25Mb2NhdGlvbiwgMiwgQGdsLkZMT0FULCBmYWxzZSwgMCwgMClcblxuICBzZXRSZWN0YW5nbGU6ICh4LCB5LCB3aWR0aCwgaGVpZ2h0KS0+XG4gICAgeDIgPSB4ICsgd2lkdGhcbiAgICB5MiA9IHkgKyBoZWlnaHRcbiAgICBAZ2wuYnVmZmVyRGF0YShAZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KFxuICAgICAgW3gsIHksXG4gICAgICAgeDIsIHksXG4gICAgICAgeCwgeTIsXG4gICAgICAgeCwgeTIsXG4gICAgICAgeDIsIHksXG4gICAgICAgeDIsIHkyXVxuICAgICAgKSwgQGdsLlNUQVRJQ19EUkFXKVxuXG4gIGluaXRfdmlkZW86ID0+XG4gICAgaWYgQHZpZFxuICAgICAgQHZpZC5zcmMgPSBAdmlkX3N0cmVhbVxuICAgICAgQGFuaW1faWQgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKEByZW5kZXIpXG4gICAgZWxzZVxuICAgICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgb3IgbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSBvciBuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhXG4gICAgICBAdmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndmlkZW8nKVxuICAgICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSh7dmlkZW86IHRydWUsIGF1ZGlvOiBmYWxzZX0sIFxuICAgICAgICAoc3RyZWFtKT0+XG4gICAgICAgICAgQHZpZF9zdHJlYW0gPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pXG4gICAgICAgICAgQHZpZC5zcmMgPSBAdmlkX3N0cmVhbVxuICAgICAgICAsIC0+XG4gICAgICAgICAgYWxlcnQgXCJlcnJvclwiKVxuICAgICAgQGluaXQoKVxuXG4gIGluaXRfdGV4dHVyZXM6IC0+XG4gICAgQHRleHR1cmUgPSBAZ2wuY3JlYXRlVGV4dHVyZSgpXG4gICAgQGdsLmJpbmRUZXh0dXJlKEBnbC5URVhUVVJFXzJELCBAdGV4dHVyZSlcbiAgICBAZ2wudGV4UGFyYW1ldGVyaShAZ2wuVEVYVFVSRV8yRCwgQGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgQGdsLkxJTkVBUilcbiAgICBAZ2wudGV4UGFyYW1ldGVyaShAZ2wuVEVYVFVSRV8yRCwgQGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgQGdsLkxJTkVBUilcbiAgICBAZ2wudGV4UGFyYW1ldGVyaShAZ2wuVEVYVFVSRV8yRCwgQGdsLlRFWFRVUkVfV1JBUF9TLCBAZ2wuQ0xBTVBfVE9fRURHRSkgXG4gICAgQGdsLnRleFBhcmFtZXRlcmkoQGdsLlRFWFRVUkVfMkQsIEBnbC5URVhUVVJFX1dSQVBfVCwgQGdsLkNMQU1QX1RPX0VER0UpIFxuXG4gIHVwZGF0ZV90ZXh0dXJlOiAtPlxuICAgIEBnbC5iaW5kVGV4dHVyZShAZ2wuVEVYVFVSRV8yRCwgQHRleHR1cmUpXG4gICAgI0BnbC5waXhlbFN0b3JlaShAZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdHJ1ZSlcbiAgICBAZ2wudGV4SW1hZ2UyRChAZ2wuVEVYVFVSRV8yRCwgMCwgQGdsLlJHQkEsIEBnbC5SR0JBLFxuICAgICAgQGdsLlVOU0lHTkVEX0JZVEUsIEB2aWQpXG5cbiAgc3RhcnRfdmlkZW86ID0+XG4gICAgaWYgbm90IEB2aWRlb1xuICAgICAgQGluaXRfdmlkZW8oKVxuICAgICAgQHZpZGVvID0gdHJ1ZVxuICBzdG9wX3ZpZGVvOiA9PlxuICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZShAYW5pbV9pZClcbiAgICBAdmlkZW8gPSBmYWxzZVxuICAgIEBnbC5jbGVhckNvbG9yKDEuMCwgMS4wLCAxLjAsIDEuMClcbiAgICBAZ2wuY2xlYXIoQGdsLkNPTE9SX0JVRkZFUl9CSVQpXG5cblxuXG4gICAgXG5cblxubW9kdWxlLmV4cG9ydHMgPSBHcmFwaGljcyJdfQ==
